<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Parsing and cleaning the HHC excel workbook – The Fan</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-dae3192f81785cf0e6fe7ca13257d296.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">The Fan</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#cleaning" id="toc-cleaning" class="nav-link active" data-scroll-target="#cleaning">Cleaning</a>
  <ul class="collapse">
  <li><a href="#load-the-excel-file" id="toc-load-the-excel-file" class="nav-link" data-scroll-target="#load-the-excel-file">Load the excel file</a></li>
  <li><a href="#extract-and-fill-year-and-chair" id="toc-extract-and-fill-year-and-chair" class="nav-link" data-scroll-target="#extract-and-fill-year-and-chair">Extract and fill year and chair</a></li>
  <li><a href="#clean-columns" id="toc-clean-columns" class="nav-link" data-scroll-target="#clean-columns">Clean columns</a></li>
  <li><a href="#split-year-and-chair" id="toc-split-year-and-chair" class="nav-link" data-scroll-target="#split-year-and-chair">Split year and chair</a></li>
  <li><a href="#split-chair-names-out" id="toc-split-chair-names-out" class="nav-link" data-scroll-target="#split-chair-names-out">Split chair names out</a></li>
  <li><a href="#split-addresses-from-hosts" id="toc-split-addresses-from-hosts" class="nav-link" data-scroll-target="#split-addresses-from-hosts">Split addresses from hosts</a></li>
  <li><a href="#further-split-addresses" id="toc-further-split-addresses" class="nav-link" data-scroll-target="#further-split-addresses">Further split addresses</a></li>
  <li><a href="#recoding-and-rearranging" id="toc-recoding-and-rearranging" class="nav-link" data-scroll-target="#recoding-and-rearranging">Recoding and rearranging</a></li>
  </ul></li>
  <li><a href="#quick-cleaning-analysis" id="toc-quick-cleaning-analysis" class="nav-link" data-scroll-target="#quick-cleaning-analysis">Quick cleaning analysis</a>
  <ul class="collapse">
  <li><a href="#tighten-up-street-names" id="toc-tighten-up-street-names" class="nav-link" data-scroll-target="#tighten-up-street-names">Tighten up street names</a></li>
  </ul></li>
  <li><a href="#match-addresses" id="toc-match-addresses" class="nav-link" data-scroll-target="#match-addresses">Match addresses</a>
  <ul class="collapse">
  <li><a href="#save-final-data" id="toc-save-final-data" class="nav-link" data-scroll-target="#save-final-data">Save final data</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Parsing and cleaning the HHC excel workbook</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="cleaning" class="level1">
<h1>Cleaning</h1>
<p>Many changes to the workbook are made here in the python code. However, some changes were required directly in the original workbook. This workbook was renamed to reflect the changes.</p>
<section id="load-the-excel-file" class="level2">
<h2 class="anchored" data-anchor-id="load-the-excel-file">Load the excel file</h2>
<p>Here is the code and the first 20 records.</p>
<div id="ab48a1f0" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="dv">0</span>):</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> load_csv_file(</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>        CSV_HHT_FILE,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        skip_rows<span class="op">=</span><span class="dv">3</span>,             <span class="co"># Skip first 3 rows (0-based index)</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        header_row<span class="op">=</span><span class="va">None</span>,         <span class="co"># No header row in the file</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        column_names<span class="op">=</span>[<span class="st">"data"</span>]    <span class="co"># Manually assign column name</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> load_excel_sheet(</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        EXCEL_HHT_FILE,</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>        skip_rows<span class="op">=</span><span class="dv">3</span>,             <span class="co"># Skip first 3 rows (0-based index)</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>        header_row<span class="op">=</span><span class="va">None</span>,         <span class="co"># No header row in the file</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>        column_names<span class="op">=</span>[<span class="st">"data"</span>],   <span class="co"># Manually assign column name</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        columns<span class="op">=</span>[<span class="dv">0</span>]</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[Info] No mojibake detected. No repair needed.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">data</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1963 - Chair, Mrs. Van Pelt (Virginia) Sessoms</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>307 N. Allen Ave. – Mr. &amp; Mrs. Richard (Ann) V...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1825 Grove Ave. – Mr. &amp; Mrs. William (Anne) Ca...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1914 Grove Ave. – Mrs. Louise Fowlkes &amp; Miss D...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2109 Hanover Ave. – Mr. &amp; Mrs. Charles (Jed) (...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>1714 Park Ave. – Mr. &amp; Mrs. Dallas (Elizabeth)...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>1725 Park Ave. – Mr. &amp; Mrs. James (Patricia) G...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>2108 Stuart Ave. -- Mr. &amp; Mrs. Mitchell (Mari...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>1964 - Chair, Mrs. Charles O. (Adella) Watlington</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>1702 Grove Ave. – Mr. &amp; Mrs. Sam (Barbara) Per...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>1909 Hanover Ave. – Mr. &amp; Mrs. John (Suzanne) ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>1643 Monument Ave. – Mr. &amp; Mrs. Horace (Sarah...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>1301 Park Ave. – Mr. &amp; Mrs. John (Margaret) Sy...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>2419 Park Ave. – Mr. &amp; Mrs. Charles (June) Wea...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>2214 Stuart Ave. – Mr. &amp; Mrs. Emmett (Jane) Reid</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>1965 - Chair, Mrs. Raymond (Jacqueline) Hodges</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>2127 Floyd Ave. – Mr. Richard Duncan</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>102 N. Shields Ave. – Mr. J. Henry Brown Jr.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>106 N. Shields Ave. – Mr. &amp; Mrs. Kenton (Marga...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>109 N. Shields Ave. – Mr. Vernon Jackson</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="extract-and-fill-year-and-chair" class="level2">
<h2 class="anchored" data-anchor-id="extract-and-fill-year-and-chair">Extract and fill year and chair</h2>
<p>We first need to flip the year and chair to the end of each record. Some additional work is required for 1983, because no tour was held that year.</p>
<p>Additional notes are also shared across records.</p>
<div id="c7d72596" class="cell" data-execution_count="3">
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">data</th>
<th data-quarto-table-cell-role="th">extracted_note</th>
<th data-quarto-table-cell-role="th">year_and_chair</th>
<th data-quarto-table-cell-role="th">notes</th>
<th data-quarto-table-cell-role="th">tour</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>307 N. Allen Ave. – Mr. &amp; Mrs. Richard (Ann) Velz</td>
<td>NaN</td>
<td>1963 - Chair, Mrs. Van Pelt (Virginia) Sessoms</td>
<td></td>
<td>A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1825 Grove Ave. – Mr. &amp; Mrs. William (Anne) Ca...</td>
<td>NaN</td>
<td>1963 - Chair, Mrs. Van Pelt (Virginia) Sessoms</td>
<td></td>
<td>A</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1914 Grove Ave. – Mrs. Louise Fowlkes &amp; Miss D...</td>
<td>NaN</td>
<td>1963 - Chair, Mrs. Van Pelt (Virginia) Sessoms</td>
<td></td>
<td>A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2109 Hanover Ave. – Mr. &amp; Mrs. Charles (Jed) (...</td>
<td>NaN</td>
<td>1963 - Chair, Mrs. Van Pelt (Virginia) Sessoms</td>
<td></td>
<td>A</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1714 Park Ave. – Mr. &amp; Mrs. Dallas (Elizabeth)...</td>
<td>NaN</td>
<td>1963 - Chair, Mrs. Van Pelt (Virginia) Sessoms</td>
<td></td>
<td>A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>1725 Park Ave. – Mr. &amp; Mrs. James (Patricia) G...</td>
<td>NaN</td>
<td>1963 - Chair, Mrs. Van Pelt (Virginia) Sessoms</td>
<td></td>
<td>A</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>2108 Stuart Ave. -- Mr. &amp; Mrs. Mitchell (Mario...</td>
<td>NaN</td>
<td>1963 - Chair, Mrs. Van Pelt (Virginia) Sessoms</td>
<td></td>
<td>A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>1702 Grove Ave. – Mr. &amp; Mrs. Sam (Barbara) Perry</td>
<td>NaN</td>
<td>1964 - Chair, Mrs. Charles O. (Adella) Watlington</td>
<td></td>
<td>A</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>1909 Hanover Ave. – Mr. &amp; Mrs. John (Suzanne) ...</td>
<td>NaN</td>
<td>1964 - Chair, Mrs. Charles O. (Adella) Watlington</td>
<td></td>
<td>A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>1643 Monument Ave. – Mr. &amp; Mrs. Horace (Sarah...</td>
<td>NaN</td>
<td>1964 - Chair, Mrs. Charles O. (Adella) Watlington</td>
<td></td>
<td>A</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>1301 Park Ave. – Mr. &amp; Mrs. John (Margaret) Synon</td>
<td>NaN</td>
<td>1964 - Chair, Mrs. Charles O. (Adella) Watlington</td>
<td></td>
<td>A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>2419 Park Ave. – Mr. &amp; Mrs. Charles (June) Weaver</td>
<td>NaN</td>
<td>1964 - Chair, Mrs. Charles O. (Adella) Watlington</td>
<td></td>
<td>A</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>2214 Stuart Ave. – Mr. &amp; Mrs. Emmett (Jane) Reid</td>
<td>NaN</td>
<td>1964 - Chair, Mrs. Charles O. (Adella) Watlington</td>
<td></td>
<td>A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>2127 Floyd Ave. – Mr. Richard Duncan</td>
<td>NaN</td>
<td>1965 - Chair, Mrs. Raymond (Jacqueline) Hodges</td>
<td></td>
<td>A</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>102 N. Shields Ave. – Mr. J. Henry Brown Jr.</td>
<td>NaN</td>
<td>1965 - Chair, Mrs. Raymond (Jacqueline) Hodges</td>
<td></td>
<td>A</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="clean-columns" class="level2">
<h2 class="anchored" data-anchor-id="clean-columns">Clean columns</h2>
<p>Miscellaneous record cleaning here. Remove odd characters, etc.</p>
<div id="43bb6597" class="cell" data-execution_count="4">
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">data</th>
<th data-quarto-table-cell-role="th">extracted_note</th>
<th data-quarto-table-cell-role="th">year_and_chair</th>
<th data-quarto-table-cell-role="th">notes</th>
<th data-quarto-table-cell-role="th">tour</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>307 N. Allen Ave. – Mr. &amp; Mrs. Richard (Ann) Velz</td>
<td>NaN</td>
<td>1963 - Chair, Mrs. Van Pelt (Virginia) Sessoms</td>
<td></td>
<td>A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1825 Grove Ave. – Mr. &amp; Mrs. William (Anne) Ca...</td>
<td>NaN</td>
<td>1963 - Chair, Mrs. Van Pelt (Virginia) Sessoms</td>
<td></td>
<td>A</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1914 Grove Ave. – Mrs. Louise Fowlkes &amp; Miss D...</td>
<td>NaN</td>
<td>1963 - Chair, Mrs. Van Pelt (Virginia) Sessoms</td>
<td></td>
<td>A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2109 Hanover Ave. – Mr. &amp; Mrs. Charles (Jed) (...</td>
<td>NaN</td>
<td>1963 - Chair, Mrs. Van Pelt (Virginia) Sessoms</td>
<td></td>
<td>A</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1714 Park Ave. – Mr. &amp; Mrs. Dallas (Elizabeth)...</td>
<td>NaN</td>
<td>1963 - Chair, Mrs. Van Pelt (Virginia) Sessoms</td>
<td></td>
<td>A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>1725 Park Ave. – Mr. &amp; Mrs. James (Patricia) G...</td>
<td>NaN</td>
<td>1963 - Chair, Mrs. Van Pelt (Virginia) Sessoms</td>
<td></td>
<td>A</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>2108 Stuart Ave. -- Mr. &amp; Mrs. Mitchell (Mario...</td>
<td>NaN</td>
<td>1963 - Chair, Mrs. Van Pelt (Virginia) Sessoms</td>
<td></td>
<td>A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>1702 Grove Ave. – Mr. &amp; Mrs. Sam (Barbara) Perry</td>
<td>NaN</td>
<td>1964 - Chair, Mrs. Charles O. (Adella) Watlington</td>
<td></td>
<td>A</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>1909 Hanover Ave. – Mr. &amp; Mrs. John (Suzanne) ...</td>
<td>NaN</td>
<td>1964 - Chair, Mrs. Charles O. (Adella) Watlington</td>
<td></td>
<td>A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>1643 Monument Ave. – Mr. &amp; Mrs. Horace (Sarah...</td>
<td>NaN</td>
<td>1964 - Chair, Mrs. Charles O. (Adella) Watlington</td>
<td></td>
<td>A</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="split-year-and-chair" class="level2">
<h2 class="anchored" data-anchor-id="split-year-and-chair">Split year and chair</h2>
<p>Starting with the year-and-chair, separate out the data to new columns.</p>
<div id="3c1d500e" class="cell" data-execution_count="5">
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">data</th>
<th data-quarto-table-cell-role="th">extracted_note</th>
<th data-quarto-table-cell-role="th">year_and_chair</th>
<th data-quarto-table-cell-role="th">notes</th>
<th data-quarto-table-cell-role="th">tour</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">chair</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>307 N. Allen Ave. – Mr. &amp; Mrs. Richard (Ann) Velz</td>
<td>NaN</td>
<td>1963 - Chair, Mrs. Van Pelt (Virginia) Sessoms</td>
<td></td>
<td>A</td>
<td>1963</td>
<td>Mrs. Van Pelt (Virginia) Sessoms</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1825 Grove Ave. – Mr. &amp; Mrs. William (Anne) Ca...</td>
<td>NaN</td>
<td>1963 - Chair, Mrs. Van Pelt (Virginia) Sessoms</td>
<td></td>
<td>A</td>
<td>1963</td>
<td>Mrs. Van Pelt (Virginia) Sessoms</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1914 Grove Ave. – Mrs. Louise Fowlkes &amp; Miss D...</td>
<td>NaN</td>
<td>1963 - Chair, Mrs. Van Pelt (Virginia) Sessoms</td>
<td></td>
<td>A</td>
<td>1963</td>
<td>Mrs. Van Pelt (Virginia) Sessoms</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2109 Hanover Ave. – Mr. &amp; Mrs. Charles (Jed) (...</td>
<td>NaN</td>
<td>1963 - Chair, Mrs. Van Pelt (Virginia) Sessoms</td>
<td></td>
<td>A</td>
<td>1963</td>
<td>Mrs. Van Pelt (Virginia) Sessoms</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1714 Park Ave. – Mr. &amp; Mrs. Dallas (Elizabeth)...</td>
<td>NaN</td>
<td>1963 - Chair, Mrs. Van Pelt (Virginia) Sessoms</td>
<td></td>
<td>A</td>
<td>1963</td>
<td>Mrs. Van Pelt (Virginia) Sessoms</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>1725 Park Ave. – Mr. &amp; Mrs. James (Patricia) G...</td>
<td>NaN</td>
<td>1963 - Chair, Mrs. Van Pelt (Virginia) Sessoms</td>
<td></td>
<td>A</td>
<td>1963</td>
<td>Mrs. Van Pelt (Virginia) Sessoms</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>2108 Stuart Ave. -- Mr. &amp; Mrs. Mitchell (Mario...</td>
<td>NaN</td>
<td>1963 - Chair, Mrs. Van Pelt (Virginia) Sessoms</td>
<td></td>
<td>A</td>
<td>1963</td>
<td>Mrs. Van Pelt (Virginia) Sessoms</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>1702 Grove Ave. – Mr. &amp; Mrs. Sam (Barbara) Perry</td>
<td>NaN</td>
<td>1964 - Chair, Mrs. Charles O. (Adella) Watlington</td>
<td></td>
<td>A</td>
<td>1964</td>
<td>Mrs. Charles O. (Adella) Watlington</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>1909 Hanover Ave. – Mr. &amp; Mrs. John (Suzanne) ...</td>
<td>NaN</td>
<td>1964 - Chair, Mrs. Charles O. (Adella) Watlington</td>
<td></td>
<td>A</td>
<td>1964</td>
<td>Mrs. Charles O. (Adella) Watlington</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>1643 Monument Ave. – Mr. &amp; Mrs. Horace (Sarah...</td>
<td>NaN</td>
<td>1964 - Chair, Mrs. Charles O. (Adella) Watlington</td>
<td></td>
<td>A</td>
<td>1964</td>
<td>Mrs. Charles O. (Adella) Watlington</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="split-chair-names-out" class="level2">
<h2 class="anchored" data-anchor-id="split-chair-names-out">Split chair names out</h2>
<p>In some cases there are multiple chairs in a single year. We also want to pull out their first and last names.</p>
<div id="601ceeaf" class="cell" data-execution_count="6">
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">chair</th>
<th data-quarto-table-cell-role="th">chair1</th>
<th data-quarto-table-cell-role="th">chair2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1963</td>
<td>Mrs. Van Pelt (Virginia) Sessoms</td>
<td>Virginia Sessoms</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1963</td>
<td>Mrs. Van Pelt (Virginia) Sessoms</td>
<td>Virginia Sessoms</td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1963</td>
<td>Mrs. Van Pelt (Virginia) Sessoms</td>
<td>Virginia Sessoms</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1963</td>
<td>Mrs. Van Pelt (Virginia) Sessoms</td>
<td>Virginia Sessoms</td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1963</td>
<td>Mrs. Van Pelt (Virginia) Sessoms</td>
<td>Virginia Sessoms</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>1963</td>
<td>Mrs. Van Pelt (Virginia) Sessoms</td>
<td>Virginia Sessoms</td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>1963</td>
<td>Mrs. Van Pelt (Virginia) Sessoms</td>
<td>Virginia Sessoms</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>1964</td>
<td>Mrs. Charles O. (Adella) Watlington</td>
<td>Adella Watlington</td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>1964</td>
<td>Mrs. Charles O. (Adella) Watlington</td>
<td>Adella Watlington</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>1964</td>
<td>Mrs. Charles O. (Adella) Watlington</td>
<td>Adella Watlington</td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>1964</td>
<td>Mrs. Charles O. (Adella) Watlington</td>
<td>Adella Watlington</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>1964</td>
<td>Mrs. Charles O. (Adella) Watlington</td>
<td>Adella Watlington</td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>1964</td>
<td>Mrs. Charles O. (Adella) Watlington</td>
<td>Adella Watlington</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>1965</td>
<td>Mrs. Raymond (Jacqueline) Hodges</td>
<td>Jacqueline Hodges</td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>1965</td>
<td>Mrs. Raymond (Jacqueline) Hodges</td>
<td>Jacqueline Hodges</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>1965</td>
<td>Mrs. Raymond (Jacqueline) Hodges</td>
<td>Jacqueline Hodges</td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>1965</td>
<td>Mrs. Raymond (Jacqueline) Hodges</td>
<td>Jacqueline Hodges</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>1965</td>
<td>Mrs. Raymond (Jacqueline) Hodges</td>
<td>Jacqueline Hodges</td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>1965</td>
<td>Mrs. Raymond (Jacqueline) Hodges</td>
<td>Jacqueline Hodges</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>1965</td>
<td>Mrs. Raymond (Jacqueline) Hodges</td>
<td>Jacqueline Hodges</td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>1966</td>
<td>Mrs. Drew (Ann) Carneal</td>
<td>Ann Carneal</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>1966</td>
<td>Mrs. Drew (Ann) Carneal</td>
<td>Ann Carneal</td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>1966</td>
<td>Mrs. Drew (Ann) Carneal</td>
<td>Ann Carneal</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>1966</td>
<td>Mrs. Drew (Ann) Carneal</td>
<td>Ann Carneal</td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>1966</td>
<td>Mrs. Drew (Ann) Carneal</td>
<td>Ann Carneal</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>1966</td>
<td>Mrs. Drew (Ann) Carneal</td>
<td>Ann Carneal</td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>1966</td>
<td>Mrs. Drew (Ann) Carneal</td>
<td>Ann Carneal</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>1967</td>
<td>Mrs. Benjamin (Mary) Harrison</td>
<td>Mary Harrison</td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>1967</td>
<td>Mrs. Benjamin (Mary) Harrison</td>
<td>Mary Harrison</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>1967</td>
<td>Mrs. Benjamin (Mary) Harrison</td>
<td>Mary Harrison</td>
<td></td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>And a list combined.</p>
<div id="e7e77465" class="cell" data-execution_count="7">
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">informal_chairs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1963</td>
<td>Virginia Sessoms</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1963</td>
<td>Virginia Sessoms</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1963</td>
<td>Virginia Sessoms</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1963</td>
<td>Virginia Sessoms</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1963</td>
<td>Virginia Sessoms</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="split-addresses-from-hosts" class="level2">
<h2 class="anchored" data-anchor-id="split-addresses-from-hosts">Split addresses from hosts</h2>
<p>Separate hosts and addresses.</p>
<div id="c9efe34b" class="cell" data-execution_count="8">
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">data</th>
<th data-quarto-table-cell-role="th">host_name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">60</td>
<td>503 Stuart Cir. - [St. John’s United Church of...</td>
<td>St. John’s United Church of Christ</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">61</td>
<td>605 N. Davis Ave. #12 [Ingleside Court] – Mr....</td>
<td>Mr. David E. Martin</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">62</td>
<td>1808 Hanover Ave. – Mr. &amp; Mrs. Henry (Reba) Mc...</td>
<td>Mr. &amp; Mrs. Henry (Reba) McVey III</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">63</td>
<td>2513 Kensington Ave. – Mr. &amp; Mrs. Walter Thoma...</td>
<td>Mr. &amp; Mrs. Walter Thomas (Marion) Davis</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">64</td>
<td>404 N. Meadow St. – Mr. &amp; Mrs. William (Brenda...</td>
<td>Mr. &amp; Mrs. William (Brenda) Wilkins, Jr.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">65</td>
<td>2601 Monument Ave. – Mr. &amp; Mrs. Sydney (Franc...</td>
<td>Mr. &amp; Mrs. Sydney (Frances) Lewis</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">66</td>
<td>2605 Monument Ave. – Mr. &amp; Mrs. Walter (Zayde)...</td>
<td>Mr. &amp; Mrs. Walter (Zayde) Dotts, Jr.</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="further-split-addresses" class="level2">
<h2 class="anchored" data-anchor-id="further-split-addresses">Further split addresses</h2>
<p>Addresses are separated into numbers, units, and all that good stuff.</p>
<div id="e977e9f4" class="cell" data-execution_count="9">
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">data</th>
<th data-quarto-table-cell-role="th">street_number</th>
<th data-quarto-table-cell-role="th">unit_number</th>
<th data-quarto-table-cell-role="th">street_name</th>
<th data-quarto-table-cell-role="th">street_type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>307 N. Allen Ave. – Mr. &amp; Mrs. Richard (Ann) Velz</td>
<td>307</td>
<td>None</td>
<td>N. Allen</td>
<td>Ave.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1825 Grove Ave. – Mr. &amp; Mrs. William (Anne) Ca...</td>
<td>1825</td>
<td>None</td>
<td>Grove</td>
<td>Ave.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1914 Grove Ave. – Mrs. Louise Fowlkes &amp; Miss D...</td>
<td>1914</td>
<td>None</td>
<td>Grove</td>
<td>Ave.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2109 Hanover Ave. – Mr. &amp; Mrs. Charles (Jed) (...</td>
<td>2109</td>
<td>None</td>
<td>Hanover</td>
<td>Ave.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1714 Park Ave. – Mr. &amp; Mrs. Dallas (Elizabeth)...</td>
<td>1714</td>
<td>None</td>
<td>Park</td>
<td>Ave.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>1725 Park Ave. – Mr. &amp; Mrs. James (Patricia) G...</td>
<td>1725</td>
<td>None</td>
<td>Park</td>
<td>Ave.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>2108 Stuart Ave. -- Mr. &amp; Mrs. Mitchell (Mario...</td>
<td>2108</td>
<td>None</td>
<td>Stuart</td>
<td>Ave.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>1702 Grove Ave. – Mr. &amp; Mrs. Sam (Barbara) Perry</td>
<td>1702</td>
<td>None</td>
<td>Grove</td>
<td>Ave.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>1909 Hanover Ave. – Mr. &amp; Mrs. John (Suzanne) ...</td>
<td>1909</td>
<td>None</td>
<td>Hanover</td>
<td>Ave.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>1643 Monument Ave. – Mr. &amp; Mrs. Horace (Sarah...</td>
<td>1643</td>
<td>None</td>
<td>Monument</td>
<td>Ave.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>1301 Park Ave. – Mr. &amp; Mrs. John (Margaret) Synon</td>
<td>1301</td>
<td>None</td>
<td>Park</td>
<td>Ave.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>2419 Park Ave. – Mr. &amp; Mrs. Charles (June) Weaver</td>
<td>2419</td>
<td>None</td>
<td>Park</td>
<td>Ave.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>2214 Stuart Ave. – Mr. &amp; Mrs. Emmett (Jane) Reid</td>
<td>2214</td>
<td>None</td>
<td>Stuart</td>
<td>Ave.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>2127 Floyd Ave. – Mr. Richard Duncan</td>
<td>2127</td>
<td>None</td>
<td>Floyd</td>
<td>Ave.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>102 N. Shields Ave. – Mr. J. Henry Brown Jr.</td>
<td>102</td>
<td>None</td>
<td>N. Shields</td>
<td>Ave.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>106 N. Shields Ave. – Mr. &amp; Mrs. Kenton (Marga...</td>
<td>106</td>
<td>None</td>
<td>N. Shields</td>
<td>Ave.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>109 N. Shields Ave. – Mr. Vernon Jackson</td>
<td>109</td>
<td>None</td>
<td>N. Shields</td>
<td>Ave.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>115 N. Shields Ave. – Mr. Jacques Van Caneghem</td>
<td>115</td>
<td>None</td>
<td>N. Shields</td>
<td>Ave.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>117 N. Shields Ave. -- Mr. &amp; Mrs. Benjamin (Ma...</td>
<td>117</td>
<td>None</td>
<td>N. Shields</td>
<td>Ave.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>121 N. Shields Ave. – Mr. J. L. Spiers, Jr.</td>
<td>121</td>
<td>None</td>
<td>N. Shields</td>
<td>Ave.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>1614 Hanover Ave.– Mr. &amp; Mrs. H. Waldo (Virgin...</td>
<td>1614</td>
<td>None</td>
<td>Hanover</td>
<td>Ave.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>1803 Hanover Ave.– Mr. &amp; Mrs. George (Judith) ...</td>
<td>1803</td>
<td>None</td>
<td>Hanover</td>
<td>Ave.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>1900 Hanover Ave.– Honorable &amp; Mrs. Fred (Jane...</td>
<td>1900</td>
<td>None</td>
<td>Hanover</td>
<td>Ave.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>1719 Park Ave.– Mr. &amp; Mrs. David (Carlyle) Cli...</td>
<td>1719</td>
<td>None</td>
<td>Park</td>
<td>Ave.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>2021 Stuart Ave.– Dr. &amp; Mrs. Bennett (Susan) M...</td>
<td>2021</td>
<td>None</td>
<td>Stuart</td>
<td>Ave.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>2013 Stuart Ave.– Mr. &amp; Mrs. Dewitt B. (Joseph...</td>
<td>2013</td>
<td>None</td>
<td>Stuart</td>
<td>Ave.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>2020 Stuart Ave.– Mr. &amp; Mrs. Robert (Ann) Burrus</td>
<td>2020</td>
<td>None</td>
<td>Stuart</td>
<td>Ave.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>1824 Grove Ave. – Miss Anne Ryland</td>
<td>1824</td>
<td>None</td>
<td>Grove</td>
<td>Ave.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>1810 Monument Ave. – Mr. George T. Williamson</td>
<td>1810</td>
<td>None</td>
<td>Monument</td>
<td>Ave.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>1414 Park Ave. – Mr. &amp; Mrs. Kemp (Delores) Hyers</td>
<td>1414</td>
<td>None</td>
<td>Park</td>
<td>Ave.</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="recoding-and-rearranging" class="level2">
<h2 class="anchored" data-anchor-id="recoding-and-rearranging">Recoding and rearranging</h2>
<p>Reorder the columns. Clean the street names and build a <em>clean address</em> for matching with city data.</p>
</section>
</section>
<section id="quick-cleaning-analysis" class="level1">
<h1>Quick cleaning analysis</h1>
<section id="tighten-up-street-names" class="level2">
<h2 class="anchored" data-anchor-id="tighten-up-street-names">Tighten up street names</h2>
<div id="5d6cac84" class="cell" data-execution_count="11">
<div class="cell-output cell-output-stdout">
<pre><code>    street_name
0         Floyd
1         Grove
2       Hanover
3    Kensington
4      Monument
5      N. Allen
6      N. Davis
7     N. Granby
8   N. Harrison
9     N. Harvie
10    N. Linden
11  N. Lombardy
12    N. Meadow
13    N. Morris
14      N. Plum
15   N. Rowland
16   N. Shields
17  N. Stafford
18         Park
19   Strawberry
20       Stuart
21   Trouvaille
22     W. Broad
23  W. Franklin
24     W. Grace
25      W. Main
26         West</code></pre>
</div>
</div>
</section>
</section>
<section id="match-addresses" class="level1">
<h1>Match addresses</h1>
<p>The following code matches HHT addresses with the city database of addresses. Some additional work on the original data set was performed to rename address locations as appropriate.</p>
<div id="f7f06d33" class="cell" data-execution_count="12">
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_4565/1427863575.py:1: DtypeWarning:

Columns (10,11,18,19) have mixed types. Specify dtype option on import or set low_memory=False.
</code></pre>
</div>
</div>
<section id="save-final-data" class="level2">
<h2 class="anchored" data-anchor-id="save-final-data">Save final data</h2>
<p>Store the final data as CSV and JSON for later use.</p>
<div id="c9857e6f" class="cell" data-execution_count="13">
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>'./data/1963-2024 HHT Homeowners_Adresses_modified.xlsx'</code></pre>
</div>
</div>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb6" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> Parsing and cleaning the HHC excel workbook</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> click</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>sys.path.append(<span class="st">".."</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fandu.utils <span class="im">import</span> load_excel_sheet, extract_and_fill_year_and_chair_column, <span class="op">\</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>        split_year_and_chair_columns, split_address_and_host, split_address_parts, <span class="op">\</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>        perform_column_cleaning, load_csv_file, recode_street_names, match_addresses, <span class="op">\</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>        build_clean_address, split_and_add_chairs, save_to_geojson</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>EXCEL_HHT_FILE <span class="op">=</span> <span class="st">'../data/1963-2024 HHT Homeowners_Adresses_modified.xlsx'</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>CSV_HHT_FILE <span class="op">=</span> <span class="st">'../data/1963-2024 HHT Homeowners_Adresses.csv'</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>CLEANED_HHT_ADDRESSES <span class="op">=</span> <span class="st">"../data/cleaned_hht_addresses.csv"</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>RVA_ADDRESSES <span class="op">=</span> <span class="st">"../data/Addresses.csv"</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>HHT_SOURCE_XLSX <span class="op">=</span> <span class="st">"./data/1963-2024 HHT Homeowners_Adresses_modified.xlsx"</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>HHT_GEO_FILE <span class="op">=</span> <span class="st">"./data/hht_addresses_with_geo.csv"</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>HHT_GEO_JSON <span class="op">=</span> <span class="st">"./data/hht_addresses_with_geo.json"</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="fu"># Cleaning</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>Many changes to the workbook are made here in the python code.  However,</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>some changes were required directly in the original workbook.  This workbook</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>was renamed to reflect the changes.</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load the excel file</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>Here is the code and the first 20 records.</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="dv">0</span>):</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> load_csv_file(</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>        CSV_HHT_FILE,</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>        skip_rows<span class="op">=</span><span class="dv">3</span>,             <span class="co"># Skip first 3 rows (0-based index)</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>        header_row<span class="op">=</span><span class="va">None</span>,         <span class="co"># No header row in the file</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>        column_names<span class="op">=</span>[<span class="st">"data"</span>]    <span class="co"># Manually assign column name</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> load_excel_sheet(</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>        EXCEL_HHT_FILE,</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>        skip_rows<span class="op">=</span><span class="dv">3</span>,             <span class="co"># Skip first 3 rows (0-based index)</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>        header_row<span class="op">=</span><span class="va">None</span>,         <span class="co"># No header row in the file</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>        column_names<span class="op">=</span>[<span class="st">"data"</span>],   <span class="co"># Manually assign column name</span></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>        columns<span class="op">=</span>[<span class="dv">0</span>]</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">20</span>)</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a><span class="fu">## Extract and fill year and chair</span></span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>We first need to flip the year and chair to the end of each record.  Some additional work</span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>is required for 1983, because no tour was held that year.</span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>Additional notes are also shared across records.</span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> extract_and_fill_year_and_chair_column(df)</span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">15</span>)</span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a><span class="fu">## Clean columns</span></span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a>Miscellaneous record cleaning here.  Remove odd characters, etc.</span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> perform_column_cleaning( df )</span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">10</span>)</span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a><span class="fu">## Split year and chair</span></span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a>Starting with the year-and-chair, separate out the data to new columns.</span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> split_year_and_chair_columns( df )</span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">10</span>)</span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a><span class="fu">## Split chair names out</span></span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a>In some cases there are multiple chairs in a single year.  We also</span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a>want to pull out their first and last names.</span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-112"><a href="#cb6-112" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb6-113"><a href="#cb6-113" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> split_and_add_chairs( df )</span>
<span id="cb6-114"><a href="#cb6-114" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">"year"</span>,<span class="st">"chair"</span>,<span class="st">"chair1"</span>,<span class="st">"chair2"</span>]].head(<span class="dv">30</span>)</span>
<span id="cb6-115"><a href="#cb6-115" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-116"><a href="#cb6-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-117"><a href="#cb6-117" aria-hidden="true" tabindex="-1"></a>And a list combined.</span>
<span id="cb6-118"><a href="#cb6-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-121"><a href="#cb6-121" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb6-122"><a href="#cb6-122" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"informal_chairs"</span>] <span class="op">=</span> df.<span class="bu">apply</span>(</span>
<span id="cb6-123"><a href="#cb6-123" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> row: <span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'chair1'</span>]<span class="sc">}</span><span class="ss"> &amp; </span><span class="sc">{</span>row[<span class="st">'chair2'</span>]<span class="sc">}</span><span class="ss">"</span> <span class="cf">if</span> pd.notna(row[<span class="st">"chair2"</span>]) <span class="kw">and</span> <span class="bu">str</span>(row[<span class="st">"chair2"</span>]).strip() <span class="op">!=</span> <span class="st">""</span> <span class="cf">else</span> row[<span class="st">"chair1"</span>],</span>
<span id="cb6-124"><a href="#cb6-124" aria-hidden="true" tabindex="-1"></a>    axis<span class="op">=</span><span class="dv">1</span></span>
<span id="cb6-125"><a href="#cb6-125" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-126"><a href="#cb6-126" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">"year"</span>,<span class="st">"informal_chairs"</span>]].head()</span>
<span id="cb6-127"><a href="#cb6-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-128"><a href="#cb6-128" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-129"><a href="#cb6-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-130"><a href="#cb6-130" aria-hidden="true" tabindex="-1"></a><span class="fu">## Split addresses from hosts</span></span>
<span id="cb6-131"><a href="#cb6-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-132"><a href="#cb6-132" aria-hidden="true" tabindex="-1"></a>Separate hosts and addresses.</span>
<span id="cb6-133"><a href="#cb6-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-136"><a href="#cb6-136" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb6-137"><a href="#cb6-137" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> split_address_and_host( df )</span>
<span id="cb6-138"><a href="#cb6-138" aria-hidden="true" tabindex="-1"></a>df[df[<span class="st">"year"</span>]<span class="op">==</span><span class="st">"1972"</span>][[<span class="st">"data"</span>,<span class="st">"host_name"</span>]].head(<span class="dv">30</span>)</span>
<span id="cb6-139"><a href="#cb6-139" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-140"><a href="#cb6-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-141"><a href="#cb6-141" aria-hidden="true" tabindex="-1"></a><span class="fu">## Further split addresses</span></span>
<span id="cb6-142"><a href="#cb6-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-143"><a href="#cb6-143" aria-hidden="true" tabindex="-1"></a>Addresses are separated into numbers, units, and all that good stuff.</span>
<span id="cb6-144"><a href="#cb6-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-147"><a href="#cb6-147" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb6-148"><a href="#cb6-148" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> split_address_parts( df )</span>
<span id="cb6-149"><a href="#cb6-149" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">"data"</span>, <span class="st">"street_number"</span>, <span class="st">"unit_number"</span>, <span class="st">"street_name"</span>, <span class="st">"street_type"</span>]].head(<span class="dv">30</span>)</span>
<span id="cb6-150"><a href="#cb6-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-151"><a href="#cb6-151" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-152"><a href="#cb6-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-153"><a href="#cb6-153" aria-hidden="true" tabindex="-1"></a><span class="fu">## Recoding and rearranging</span></span>
<span id="cb6-154"><a href="#cb6-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-155"><a href="#cb6-155" aria-hidden="true" tabindex="-1"></a>Reorder the columns.  Clean the street names and build a *clean address* for </span>
<span id="cb6-156"><a href="#cb6-156" aria-hidden="true" tabindex="-1"></a>matching with city data.</span>
<span id="cb6-157"><a href="#cb6-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-160"><a href="#cb6-160" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb6-161"><a href="#cb6-161" aria-hidden="true" tabindex="-1"></a>new_column_order <span class="op">=</span> [</span>
<span id="cb6-162"><a href="#cb6-162" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data"</span>,</span>
<span id="cb6-163"><a href="#cb6-163" aria-hidden="true" tabindex="-1"></a>    <span class="st">"year_and_chair"</span>,</span>
<span id="cb6-164"><a href="#cb6-164" aria-hidden="true" tabindex="-1"></a>    <span class="st">"notes"</span>,</span>
<span id="cb6-165"><a href="#cb6-165" aria-hidden="true" tabindex="-1"></a>    <span class="st">"year"</span>,</span>
<span id="cb6-166"><a href="#cb6-166" aria-hidden="true" tabindex="-1"></a>    <span class="st">"tour"</span>,</span>
<span id="cb6-167"><a href="#cb6-167" aria-hidden="true" tabindex="-1"></a>    <span class="st">"chair"</span>,</span>
<span id="cb6-168"><a href="#cb6-168" aria-hidden="true" tabindex="-1"></a>    <span class="st">"chair1"</span>,</span>
<span id="cb6-169"><a href="#cb6-169" aria-hidden="true" tabindex="-1"></a>    <span class="st">"chair1_first_name"</span>,</span>
<span id="cb6-170"><a href="#cb6-170" aria-hidden="true" tabindex="-1"></a>    <span class="st">"chair1_last_name"</span>,</span>
<span id="cb6-171"><a href="#cb6-171" aria-hidden="true" tabindex="-1"></a>    <span class="st">"chair2"</span>,</span>
<span id="cb6-172"><a href="#cb6-172" aria-hidden="true" tabindex="-1"></a>    <span class="st">"chair2_first_name"</span>,</span>
<span id="cb6-173"><a href="#cb6-173" aria-hidden="true" tabindex="-1"></a>    <span class="st">"chair2_last_name"</span>,</span>
<span id="cb6-174"><a href="#cb6-174" aria-hidden="true" tabindex="-1"></a>    <span class="st">"informal_chairs"</span>,</span>
<span id="cb6-175"><a href="#cb6-175" aria-hidden="true" tabindex="-1"></a>    <span class="st">"address"</span>,</span>
<span id="cb6-176"><a href="#cb6-176" aria-hidden="true" tabindex="-1"></a>    <span class="st">"street_number"</span>,</span>
<span id="cb6-177"><a href="#cb6-177" aria-hidden="true" tabindex="-1"></a>    <span class="st">"unit_number"</span>,  <span class="co"># &lt;- moved here!</span></span>
<span id="cb6-178"><a href="#cb6-178" aria-hidden="true" tabindex="-1"></a>    <span class="st">"street_name"</span>,</span>
<span id="cb6-179"><a href="#cb6-179" aria-hidden="true" tabindex="-1"></a>    <span class="st">"street_type"</span>,</span>
<span id="cb6-180"><a href="#cb6-180" aria-hidden="true" tabindex="-1"></a>    <span class="st">"place_name"</span>,</span>
<span id="cb6-181"><a href="#cb6-181" aria-hidden="true" tabindex="-1"></a>    <span class="st">"host_name"</span>,</span>
<span id="cb6-182"><a href="#cb6-182" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb6-183"><a href="#cb6-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-184"><a href="#cb6-184" aria-hidden="true" tabindex="-1"></a><span class="co">#df = df[new_column_order]</span></span>
<span id="cb6-185"><a href="#cb6-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-186"><a href="#cb6-186" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> recode_street_names( df )</span>
<span id="cb6-187"><a href="#cb6-187" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> build_clean_address( df )</span>
<span id="cb6-188"><a href="#cb6-188" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-189"><a href="#cb6-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-190"><a href="#cb6-190" aria-hidden="true" tabindex="-1"></a><span class="fu"># Quick cleaning analysis</span></span>
<span id="cb6-191"><a href="#cb6-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-192"><a href="#cb6-192" aria-hidden="true" tabindex="-1"></a><span class="fu">## Tighten up street names</span></span>
<span id="cb6-193"><a href="#cb6-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-196"><a href="#cb6-196" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb6-197"><a href="#cb6-197" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the unique street names</span></span>
<span id="cb6-198"><a href="#cb6-198" aria-hidden="true" tabindex="-1"></a>unique_street_names <span class="op">=</span> df[<span class="st">"street_name"</span>].dropna().unique()</span>
<span id="cb6-199"><a href="#cb6-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-200"><a href="#cb6-200" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort them alphabetically</span></span>
<span id="cb6-201"><a href="#cb6-201" aria-hidden="true" tabindex="-1"></a>unique_street_names <span class="op">=</span> <span class="bu">sorted</span>(unique_street_names)</span>
<span id="cb6-202"><a href="#cb6-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-203"><a href="#cb6-203" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to a DataFrame if you want it as a table</span></span>
<span id="cb6-204"><a href="#cb6-204" aria-hidden="true" tabindex="-1"></a>unique_street_names_df <span class="op">=</span> pd.DataFrame(unique_street_names, columns<span class="op">=</span>[<span class="st">"street_name"</span>])</span>
<span id="cb6-205"><a href="#cb6-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-206"><a href="#cb6-206" aria-hidden="true" tabindex="-1"></a><span class="co"># Display</span></span>
<span id="cb6-207"><a href="#cb6-207" aria-hidden="true" tabindex="-1"></a>click.echo(unique_street_names_df)</span>
<span id="cb6-208"><a href="#cb6-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-209"><a href="#cb6-209" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-210"><a href="#cb6-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-211"><a href="#cb6-211" aria-hidden="true" tabindex="-1"></a><span class="fu"># Match addresses</span></span>
<span id="cb6-212"><a href="#cb6-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-213"><a href="#cb6-213" aria-hidden="true" tabindex="-1"></a>The following code matches HHT addresses with the city database of addresses.  Some</span>
<span id="cb6-214"><a href="#cb6-214" aria-hidden="true" tabindex="-1"></a>additional work on the original data set was performed to rename address locations as appropriate.</span>
<span id="cb6-215"><a href="#cb6-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-218"><a href="#cb6-218" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb6-219"><a href="#cb6-219" aria-hidden="true" tabindex="-1"></a>master_df <span class="op">=</span> pd.read_csv(<span class="st">"../data/Addresses.csv"</span>)       <span class="co"># columns: id, address</span></span>
<span id="cb6-220"><a href="#cb6-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-221"><a href="#cb6-221" aria-hidden="true" tabindex="-1"></a>matched, unmatched <span class="op">=</span> match_addresses(master_df, df,threshold<span class="op">=</span><span class="fl">99.0</span>)</span>
<span id="cb6-222"><a href="#cb6-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-223"><a href="#cb6-223" aria-hidden="true" tabindex="-1"></a><span class="co"># Save to files if desired</span></span>
<span id="cb6-224"><a href="#cb6-224" aria-hidden="true" tabindex="-1"></a>matched.to_csv(<span class="st">"matched.csv"</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb6-225"><a href="#cb6-225" aria-hidden="true" tabindex="-1"></a>unmatched.to_csv(<span class="st">"unmatched.csv"</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb6-226"><a href="#cb6-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-227"><a href="#cb6-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-228"><a href="#cb6-228" aria-hidden="true" tabindex="-1"></a><span class="co"># remove duplicates from matched</span></span>
<span id="cb6-229"><a href="#cb6-229" aria-hidden="true" tabindex="-1"></a>matched <span class="op">=</span> matched.drop_duplicates(subset<span class="op">=</span>[<span class="st">"unmatched_address"</span>])</span>
<span id="cb6-230"><a href="#cb6-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-231"><a href="#cb6-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-232"><a href="#cb6-232" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Merge hht_addresses_df with matched to get matched_id</span></span>
<span id="cb6-233"><a href="#cb6-233" aria-hidden="true" tabindex="-1"></a>merged_hht <span class="op">=</span> df.merge(</span>
<span id="cb6-234"><a href="#cb6-234" aria-hidden="true" tabindex="-1"></a>    matched,</span>
<span id="cb6-235"><a href="#cb6-235" aria-hidden="true" tabindex="-1"></a>    left_on<span class="op">=</span><span class="st">"clean_address"</span>,</span>
<span id="cb6-236"><a href="#cb6-236" aria-hidden="true" tabindex="-1"></a>    right_on<span class="op">=</span><span class="st">"unmatched_address"</span>,</span>
<span id="cb6-237"><a href="#cb6-237" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">"left"</span></span>
<span id="cb6-238"><a href="#cb6-238" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-239"><a href="#cb6-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-240"><a href="#cb6-240" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Merge in additional fields from master_df using matched_id</span></span>
<span id="cb6-241"><a href="#cb6-241" aria-hidden="true" tabindex="-1"></a>columns_to_merge <span class="op">=</span> [</span>
<span id="cb6-242"><a href="#cb6-242" aria-hidden="true" tabindex="-1"></a>    <span class="st">'AddressId'</span>, <span class="st">'ZipCode'</span>, <span class="st">'X'</span>, <span class="st">'Y'</span>,</span>
<span id="cb6-243"><a href="#cb6-243" aria-hidden="true" tabindex="-1"></a>    <span class="st">'StatePlaneX'</span>, <span class="st">'StatePlaneY'</span>, <span class="st">'Latitude'</span>, <span class="st">'Longitude'</span></span>
<span id="cb6-244"><a href="#cb6-244" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb6-245"><a href="#cb6-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-246"><a href="#cb6-246" aria-hidden="true" tabindex="-1"></a>merged_final <span class="op">=</span> merged_hht.merge(</span>
<span id="cb6-247"><a href="#cb6-247" aria-hidden="true" tabindex="-1"></a>    master_df[columns_to_merge],</span>
<span id="cb6-248"><a href="#cb6-248" aria-hidden="true" tabindex="-1"></a>    left_on<span class="op">=</span><span class="st">"matched_id"</span>,</span>
<span id="cb6-249"><a href="#cb6-249" aria-hidden="true" tabindex="-1"></a>    right_on<span class="op">=</span><span class="st">"AddressId"</span>,</span>
<span id="cb6-250"><a href="#cb6-250" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">"left"</span></span>
<span id="cb6-251"><a href="#cb6-251" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-252"><a href="#cb6-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-253"><a href="#cb6-253" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: drop helper columns if you want</span></span>
<span id="cb6-254"><a href="#cb6-254" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> merged_final.drop(columns<span class="op">=</span>[<span class="st">"unmatched_address"</span>])</span>
<span id="cb6-255"><a href="#cb6-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-256"><a href="#cb6-256" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(columns<span class="op">=</span>[<span class="st">"X"</span>, <span class="st">"Y"</span>])</span>
<span id="cb6-257"><a href="#cb6-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-258"><a href="#cb6-258" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.rename(columns<span class="op">=</span>{</span>
<span id="cb6-259"><a href="#cb6-259" aria-hidden="true" tabindex="-1"></a>    <span class="st">"AddressId"</span>: <span class="st">"city_address_id"</span>,</span>
<span id="cb6-260"><a href="#cb6-260" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ZipCode"</span>: <span class="st">"zip_code"</span>,</span>
<span id="cb6-261"><a href="#cb6-261" aria-hidden="true" tabindex="-1"></a>    <span class="st">"StatePlaneX"</span>: <span class="st">"state_plane_x"</span>,</span>
<span id="cb6-262"><a href="#cb6-262" aria-hidden="true" tabindex="-1"></a>    <span class="st">"StatePlaneY"</span>: <span class="st">"state_plane_y"</span>,</span>
<span id="cb6-263"><a href="#cb6-263" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Latitude"</span>: <span class="st">"latitude"</span>,</span>
<span id="cb6-264"><a href="#cb6-264" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Longitude"</span>: <span class="st">"longitude"</span></span>
<span id="cb6-265"><a href="#cb6-265" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb6-266"><a href="#cb6-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-267"><a href="#cb6-267" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-268"><a href="#cb6-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-269"><a href="#cb6-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-270"><a href="#cb6-270" aria-hidden="true" tabindex="-1"></a><span class="fu">## Save final data</span></span>
<span id="cb6-271"><a href="#cb6-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-272"><a href="#cb6-272" aria-hidden="true" tabindex="-1"></a>Store the final data as CSV and JSON for later use.</span>
<span id="cb6-273"><a href="#cb6-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-274"><a href="#cb6-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-277"><a href="#cb6-277" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb6-278"><a href="#cb6-278" aria-hidden="true" tabindex="-1"></a><span class="co"># Save to file or continue processing</span></span>
<span id="cb6-279"><a href="#cb6-279" aria-hidden="true" tabindex="-1"></a>df.to_csv(HHT_GEO_FILE, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb6-280"><a href="#cb6-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-281"><a href="#cb6-281" aria-hidden="true" tabindex="-1"></a><span class="co"># Save to JSON for mapping</span></span>
<span id="cb6-282"><a href="#cb6-282" aria-hidden="true" tabindex="-1"></a>save_to_geojson( df, HHT_GEO_JSON )</span>
<span id="cb6-283"><a href="#cb6-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-284"><a href="#cb6-284" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure original XLSX is available on HTML path.</span></span>
<span id="cb6-285"><a href="#cb6-285" aria-hidden="true" tabindex="-1"></a>shutil.copyfile( EXCEL_HHT_FILE, HHT_SOURCE_XLSX )</span>
<span id="cb6-286"><a href="#cb6-286" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>